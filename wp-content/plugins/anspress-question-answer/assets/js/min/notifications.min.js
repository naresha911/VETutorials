!function(a){AnsPress.loadTemplate("notifications"),AnsPress.models.Notification=Backbone.Model.extend({idAttribute:"ID",defaults:{ID:"",verb:"",verb_label:"",icon:"",avatar:"",hide_actor:"",actor:"",ref_title:"",ref_type:"",points:"",date:"",permalink:"",seen:""}}),AnsPress.collections.Notifications=Backbone.Collection.extend({model:AnsPress.models.Notification}),AnsPress.views.Notification=Backbone.View.extend({id:function(){return"noti-"+this.model.id},template:AnsPress.getTemplate("notification"),initialize:function(a){this.model=a.model},render:function(){var a=_.template(this.template());return this.$el.html(a(this.model.toJSON())),this}}),AnsPress.views.Notifications=Backbone.View.extend({template:AnsPress.getTemplate("notifications"),initialize:function(a){this.model=a.model,this.mark_args=a.mark_args,this.total=a.total,this.listenTo(this.model,"add",this.newNoti),this.listenTo(AnsPress,"notificationAllRead",this.allRead)},renderItem:function(a){var b=new AnsPress.views.Notification({model:a});return this.$el.find(".scroll-wrap").append(b.render().$el),b},render:function(){var a=this,b=_.template(this.template());return this.$el.html(b({mark_args:this.mark_args,total:this.total})),this.model.length>0&&this.model.each(function(b){a.renderItem(b)}),this},newNoti:function(a){this.renderItem(a)},allRead:function(){this.total=0,this.model.each(function(a){a.set("seen",1)}),this.render()}}),AnsPress.views.NotiDropdown=Backbone.View.extend({id:"noti-dp",initialize:function(a){this.anchor=a.anchor,this.fetched=!1},dpPos:function(){var a=this.anchor.offset();a.top=a.top+this.anchor.height(),a.left=a.left-this.$el.width()+this.anchor.width(),this.$el.css(a)},fetchNoti:function(a,b){if(this.fetched)return void this.dpPos();var c=this;AnsPress.ajax({data:ajaxurl+"?action=ap_ajax&ap_ajax_action=get_notifications",success:function(a){if(c.fetched=!0,a.success){var b=new AnsPress.collections.Notifications(a.notifications),d=new AnsPress.views.Notifications({model:b,mark_args:a.mark_args,total:a.total});c.$el.html(d.render().$el),c.dpPos(),c.$el.show()}}})},render:function(){return this.$el.hide(),this}}),a(document).ready(function(){var b=a('a[href="#apNotifications"]'),c=new AnsPress.views.NotiDropdown({anchor:b});a("body").append(c.render().$el),b.click(function(a){a.preventDefault(),c.fetchNoti(),c.fetched&&c.$el.toggle()}),a(document).mouseup(function(a){b.is(a.target)||c.$el.is(a.target)||0!==c.$el.has(a.target).length||c.$el.hide()})})}(jQuery);
//# sourceMappingURL=notifications.min.js.map